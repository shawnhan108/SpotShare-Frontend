{"version":3,"sources":["../../../../src/lib/fetch/fetch-file.browser.js"],"names":["assert","FileReadableResponse","constructor","fileOrBlob","_fileOrBlob","bodyUsed","headers","Headers","size","type","url","name","arrayBuffer","reader","promise","_getFileReader","readAsArrayBuffer","text","readAsText","json","JSON","parse","Promise","resolve","reject","FileReader","onerror","error","Error","onabort","onload","result","fetchFileReadable","options"],"mappings":";AACA,OAAOA,MAAP,MAAmB,oBAAnB;;AAGA,MAAMC,oBAAN,CAA2B;AACzBC,EAAAA,WAAW,CAACC,UAAD,EAAa;AACtB,SAAKC,WAAL,GAAmBD,UAAnB;AACA,SAAKE,QAAL,GAAgB,KAAhB;AACD;;AAED,MAAIC,OAAJ,GAAc;AACZ,WAAO,IAAIC,OAAJ,CAAY;AACjB,wBAAkB,KAAKH,WAAL,CAAiBI,IADlB;AAEjB,sBAAgB,KAAKJ,WAAL,CAAiBK;AAFhB,KAAZ,CAAP;AAID;;AAEDC,EAAAA,GAAG,GAAG;AAGJ,WAAO,KAAKN,WAAL,CAAiBO,IAAjB,IAAyB,EAAhC;AACD;;AAEKC,EAAAA,WAAN,GAAoB;AAAA;;AAAA;AAClB,UAAM;AAACC,QAAAA,MAAD;AAASC,QAAAA;AAAT,UAAoB,KAAI,CAACC,cAAL,EAA1B;;AACAF,MAAAA,MAAM,CAACG,iBAAP,CAAyB,KAAI,CAACZ,WAA9B;AACA,aAAOU,OAAP;AAHkB;AAInB;;AAEKG,EAAAA,IAAN,GAAa;AAAA;;AAAA;AACX,UAAM;AAACJ,QAAAA,MAAD;AAASC,QAAAA;AAAT,UAAoB,MAAI,CAACC,cAAL,EAA1B;;AACAF,MAAAA,MAAM,CAACK,UAAP,CAAkB,MAAI,CAACd,WAAvB;AACA,aAAOU,OAAP;AAHW;AAIZ;;AAEKK,EAAAA,IAAN,GAAa;AAAA;;AAAA;AACX,UAAMF,IAAI,SAAS,MAAI,CAACA,IAAL,EAAnB;AACA,aAAOG,IAAI,CAACC,KAAL,CAAWJ,IAAX,CAAP;AAFW;AAGZ;;AAYDF,EAAAA,cAAc,GAAG;AACff,IAAAA,MAAM,CAAC,CAAC,KAAKK,QAAP,CAAN;AACA,SAAKA,QAAL,GAAgB,IAAhB;AAEA,QAAIQ,MAAJ;AACA,QAAMC,OAAO,GAAG,IAAIQ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC/C,UAAI;AACFX,QAAAA,MAAM,GAAG,IAAIY,UAAJ,EAAT;;AACAZ,QAAAA,MAAM,CAACa,OAAP,GAAiBC,KAAK,IAAIH,MAAM,CAAC,IAAII,KAAJ,CAAUD,KAAV,CAAD,CAAhC;;AACAd,QAAAA,MAAM,CAACgB,OAAP,GAAiB,MAAML,MAAM,CAAC,IAAII,KAAJ,CAAU,eAAV,CAAD,CAA7B;;AACAf,QAAAA,MAAM,CAACiB,MAAP,GAAgB,MAAMP,OAAO,CAACV,MAAM,CAACkB,MAAR,CAA7B;AACD,OALD,CAKE,OAAOJ,KAAP,EAAc;AACdH,QAAAA,MAAM,CAACG,KAAD,CAAN;AACD;AACF,KATe,CAAhB;AAUA,WAAO;AAACd,MAAAA,MAAD;AAASC,MAAAA;AAAT,KAAP;AACD;;AA9DwB;;AAmE3B,eAAe,SAASkB,iBAAT,CAA2B7B,UAA3B,EAAuC8B,OAAvC,EAAgD;AAC7D,SAAOX,OAAO,CAACC,OAAR,CAAgB,IAAItB,oBAAJ,CAAyBE,UAAzB,EAAqC8B,OAArC,CAAhB,CAAP;AACD","sourcesContent":["/* global FileReader, Headers */\nimport assert from '../../utils/assert';\n\n// File reader fetch \"polyfill\" for the browser\nclass FileReadableResponse {\n  constructor(fileOrBlob) {\n    this._fileOrBlob = fileOrBlob;\n    this.bodyUsed = false;\n  }\n\n  get headers() {\n    return new Headers({\n      'Content-Length': this._fileOrBlob.size,\n      'Content-Type': this._fileOrBlob.type\n    });\n  }\n\n  url() {\n    // Note: This is just the file name without path information\n    // Note: File has `name` field but the Blob baseclass does not\n    return this._fileOrBlob.name || '';\n  }\n\n  async arrayBuffer() {\n    const {reader, promise} = this._getFileReader();\n    reader.readAsArrayBuffer(this._fileOrBlob);\n    return promise;\n  }\n\n  async text() {\n    const {reader, promise} = this._getFileReader();\n    reader.readAsText(this._fileOrBlob);\n    return promise;\n  }\n\n  async json() {\n    const text = await this.text();\n    return JSON.parse(text);\n  }\n\n  // TODO - body, how to support stream?\n  // Can this be portable?\n  // eslint-disable-next-line\n  // https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams#Creating_your_own_custom_readable_stream\n  // get body() {\n  //   assert(false);\n  // }\n\n  // PRIVATE\n\n  _getFileReader() {\n    assert(!this.bodyUsed);\n    this.bodyUsed = true;\n\n    let reader;\n    const promise = new Promise((resolve, reject) => {\n      try {\n        reader = new FileReader();\n        reader.onerror = error => reject(new Error(error));\n        reader.onabort = () => reject(new Error('Read aborted.'));\n        reader.onload = () => resolve(reader.result);\n      } catch (error) {\n        reject(error);\n      }\n    });\n    return {reader, promise};\n  }\n}\n\n// @param {File|Blob} file  HTML File or Blob object to read as string\n// @returns {Promise.string}  Resolves to a string containing file contents\nexport default function fetchFileReadable(fileOrBlob, options) {\n  return Promise.resolve(new FileReadableResponse(fileOrBlob, options));\n}\n"],"file":"fetch-file.browser.js"}