{"ast":null,"code":"import _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/SHAWN/Downloads/SpotShare/src/components/Feed/Post/Post.js\";\nimport React, { Component } from 'react';\nimport openSocket from 'socket.io-client';\nimport Button from '../../Button/Button';\nimport './Post.css';\nimport { Container, Row } from 'react-bootstrap';\nimport Loader from '../../Loader/Loader';\n\nvar post =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(post, _Component);\n\n  function post() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, post);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(post)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      bucketNum: 0,\n      postInBucket: false,\n      btnTitle: 'Bucket!',\n      loading: 'true'\n    };\n\n    _this.bucketHandler = function () {\n      if (!_this.state.postInBucket) {\n        fetch('http://localhost:8080/feed/bucket-num/' + _this.props.id, {\n          method: 'PATCH',\n          headers: {\n            Authorization: 'Bearer ' + _this.props.token,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            newBucketNum: _this.state.bucketNum + 1\n          })\n        }).then(function (res) {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error(\"Can't update bucket number!\");\n          }\n\n          return res.json();\n        }).then(function (resData) {\n          _this.setState({\n            postInBucket: true,\n            btnTitle: 'Unbucket!'\n          });\n\n          var socket = openSocket('http://localhost:8080');\n          socket.on('bucket', function (data) {\n            if (data.action === 'update') {\n              _this.updateBucketNum(data.newBucketNum);\n            }\n          });\n          return _this.props.onBucket();\n        }).catch(_this.catchError);\n      } else {\n        fetch('http://localhost:8080/feed/bucket-num/' + _this.props.id, {\n          method: 'PATCH',\n          headers: {\n            Authorization: 'Bearer ' + _this.props.token,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            newBucketNum: _this.state.bucketNum - 1\n          })\n        }).then(function (res) {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error(\"Can't update bucket number!\");\n          }\n\n          return res.json();\n        }).then(function (resData) {\n          console.log(resData);\n\n          _this.setState({\n            postInBucket: false,\n            btnTitle: 'Bucket!'\n          });\n\n          var socket = openSocket('http://localhost:8080');\n          socket.on('bucket', function (data) {\n            if (data.action === 'update') {\n              _this.updateBucketNum(data.newBucketNum);\n            }\n          });\n          return _this.props.offBucket();\n        }).catch(_this.catchError);\n      }\n    };\n\n    _this.updateBucketNum = function (newBucketNum) {\n      _this.setState({\n        btnTitle: _this.state.btnTitle.split(\"(\")[0] + \"(\" + newBucketNum + \")\"\n      });\n\n      _this.render();\n    };\n\n    return _this;\n  }\n\n  _createClass(post, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('http://localhost:8080/feed/bucket-num/' + this.props.id, {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket number failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        _this2.setState({\n          bucketNum: resData.bucketNum\n        });\n\n        return resData;\n      }).then(function (resData) {\n        if (_this2.props.userBucket.includes(_this2.props.id)) {\n          _this2.setState({\n            postInBucket: true,\n            btnTitle: 'Unbucket!(' + resData.bucketNum + ')'\n          });\n        } else {\n          _this2.setState({\n            postInBucket: false,\n            btnTitle: 'Bucket!(' + resData.bucketNum + ')'\n          });\n        }\n\n        _this2.setState({\n          loading: 'false'\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.loading === 'true') {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        });\n      }\n\n      ;\n\n      if (this.props.author._id === localStorage.getItem('userId')) {\n        return React.createElement(\"article\", {\n          className: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138\n          },\n          __self: this\n        }, React.createElement(\"header\", {\n          className: \"post__header\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139\n          },\n          __self: this\n        }, React.createElement(\"h1\", {\n          className: \"post__title text-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }, this.props.title), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        }), React.createElement(\"h3\", {\n          className: \"post__infos\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, \"Posted by \", this.props.author.name, \" on \", this.props.date, \" ||  Shot at \", this.props.location.text, \" on \", this.props.taken_date)), React.createElement(\"div\", {\n          className: \"post__image\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          className: \"post_img\",\n          src: 'http://localhost:8080/' + this.props.image,\n          alt: this.props.title,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        })), React.createElement(Container, {\n          className: \"text-center buttonbar\",\n          style: \"text-align: center;width: 30rem;\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }, React.createElement(Row, {\n          className: \"text-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"button-pad pull-right\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          link: this.props.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"View\")), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          onClick: this.props.onStartEdit,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          },\n          __self: this\n        }, \"Edit\")), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          onClick: this.props.startReview,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, \"Review\")), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          design: \"danger\",\n          colorChange: \"colorChange\",\n          onClick: this.bucketHandler,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 167\n          },\n          __self: this\n        }, this.state.btnTitle)), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          design: \"danger\",\n          onClick: this.props.onDelete,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, \"Delete\")))));\n      } else {\n        return React.createElement(\"article\", {\n          className: \"post\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, React.createElement(\"header\", {\n          className: \"post__header\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          },\n          __self: this\n        }, React.createElement(\"h1\", {\n          className: \"post__title text-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        }, this.props.title), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }), React.createElement(\"h3\", {\n          className: \"post__infos\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, \"Posted by \", this.props.author.name, \" on \", this.props.date, \" ||  Shot at \", this.props.location.text, \" on \", this.props.taken_date)), React.createElement(\"div\", {\n          className: \"post__image\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          className: \"post_img\",\n          src: 'http://localhost:8080/' + this.props.image,\n          alt: this.props.title,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        })), React.createElement(Container, {\n          className: \"text-center buttonbar\",\n          style: \"text-align: center;width: 15rem;\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(Row, {\n          className: \"text-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"button-pad pull-right\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          link: this.props.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, \"View\")), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          onClick: this.props.startReview,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }, \"Review\")), React.createElement(\"div\", {\n          className: \"button-pad\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, React.createElement(Button, {\n          mode: \"flat\",\n          design: \"danger\",\n          colorChange: \"colorChange\",\n          onClick: this.bucketHandler,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 206\n          },\n          __self: this\n        }, this.state.btnTitle)))));\n      }\n    }\n  }]);\n\n  return post;\n}(Component);\n\nexport default post;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/components/Feed/Post/Post.js"],"names":["React","Component","openSocket","Button","Container","Row","Loader","post","state","bucketNum","postInBucket","btnTitle","loading","bucketHandler","fetch","props","id","method","headers","Authorization","token","body","JSON","stringify","newBucketNum","then","res","status","Error","json","resData","setState","socket","on","data","action","updateBucketNum","onBucket","catch","catchError","console","log","offBucket","split","render","userBucket","includes","err","author","_id","localStorage","getItem","title","name","date","location","text","taken_date","image","onStartEdit","startReview","onDelete"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport openSocket from 'socket.io-client';\n\nimport Button from '../../Button/Button';\nimport './Post.css';\nimport { Container, Row } from 'react-bootstrap';\nimport Loader from '../../Loader/Loader';\n\nclass post extends Component {\n  state = {\n    bucketNum: 0,\n    postInBucket: false,\n    btnTitle: 'Bucket!',\n    loading: 'true'\n  };\n\n  bucketHandler = () => {\n    if (!this.state.postInBucket) {\n      fetch('http://localhost:8080/feed/bucket-num/' + this.props.id, {\n        method: 'PATCH',\n        headers: {\n          Authorization: 'Bearer ' + this.props.token,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          newBucketNum: this.state.bucketNum + 1\n        })\n      })\n      .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error(\"Can't update bucket number!\");\n          }\n          return res.json();\n        })\n      .then(resData => {\n          this.setState({\n            postInBucket: true,\n            btnTitle: 'Unbucket!'\n          });\n          const socket = openSocket('http://localhost:8080');\n          socket.on('bucket', data => {\n            if (data.action === 'update') {\n              this.updateBucketNum(data.newBucketNum);\n            }\n          });\n          return this.props.onBucket();\n        })\n      .catch(this.catchError);     \n    }\n    else {\n      fetch('http://localhost:8080/feed/bucket-num/' + this.props.id, {\n        method: 'PATCH',\n        headers: {\n          Authorization: 'Bearer ' + this.props.token,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          newBucketNum: this.state.bucketNum - 1\n        })\n      })\n      .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error(\"Can't update bucket number!\");\n          }\n          return res.json();\n        })\n      .then(resData => {\n          console.log(resData);\n          this.setState({\n            postInBucket: false,\n            btnTitle: 'Bucket!'\n          });\n          const socket = openSocket('http://localhost:8080');\n          socket.on('bucket', data => {\n            if (data.action === 'update') {\n              this.updateBucketNum(data.newBucketNum);\n            }\n          });\n          return this.props.offBucket();\n        })\n      .catch(this.catchError);\n    }\n  }\n\n  updateBucketNum = (newBucketNum) => {\n    this.setState({\n      btnTitle: this.state.btnTitle.split(\"(\")[0] + \"(\" + newBucketNum + \")\"\n    })\n    this.render();\n  }\n\n  componentDidMount() {\n    fetch('http://localhost:8080/feed/bucket-num/' + this.props.id, {\n      headers: {\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket number failed!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        this.setState({\n          bucketNum: resData.bucketNum\n        });\n        return resData;\n      })\n      .then(resData => {\n        if (this.props.userBucket.includes(this.props.id)) {\n          this.setState({\n            postInBucket: true,\n            btnTitle: 'Unbucket!(' + resData.bucketNum + ')'\n          });\n        }\n        else {\n          this.setState({\n            postInBucket: false,\n            btnTitle: 'Bucket!(' + resData.bucketNum + ')'\n          });\n        }\n        this.setState({\n          loading: 'false'\n        });\n      })\n      .catch(err => {\n        console.log(err);\n      });\n  }\n\n  render() {\n    if (this.state.loading === 'true') {\n      return <Loader />\n    };\n    if (this.props.author._id === localStorage.getItem('userId')){\n      return (\n        <article className=\"post\">\n          <header className=\"post__header\">\n            <h1 className=\"post__title text-center\">{this.props.title}</h1>\n            <hr></hr>\n            <h3 className=\"post__infos\">\n              Posted by {this.props.author.name} on {this.props.date} ||  Shot at {this.props.location.text} on {this.props.taken_date}\n            </h3>\n          </header>\n          <div className=\"post__image\">\n            <img className=\"post_img\" src={'http://localhost:8080/' + this.props.image} alt={this.props.title} />\n          </div>\n          <Container className=\"text-center buttonbar\" style=\"text-align: center;width: 30rem;\">\n            <Row className=\"text-center\">\n              <div className=\"button-pad pull-right\">\n                <Button mode=\"flat\" link={this.props.id}>\n                  View\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" onClick={this.props.onStartEdit}>\n                  Edit\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" onClick={this.props.startReview}>\n                  Review\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" design=\"danger\" colorChange=\"colorChange\" onClick={this.bucketHandler}>\n                  {this.state.btnTitle}\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" design=\"danger\" onClick={this.props.onDelete}>\n                  Delete\n                </Button>\n              </div>\n            </Row>\n          </Container>\n        </article>\n      )\n    } else{\n      return (\n        <article className=\"post\">\n          <header className=\"post__header\">\n            <h1 className=\"post__title text-center\">{this.props.title}</h1>\n            <hr></hr>\n            <h3 className=\"post__infos\">\n              Posted by {this.props.author.name} on {this.props.date} ||  Shot at {this.props.location.text} on {this.props.taken_date}\n            </h3>\n          </header>\n          <div className=\"post__image\">\n            <img className=\"post_img\" src={'http://localhost:8080/' + this.props.image} alt={this.props.title} />\n          </div>\n          <Container className=\"text-center buttonbar\" style=\"text-align: center;width: 15rem;\">\n            <Row className=\"text-center\">\n              <div className=\"button-pad pull-right\">\n                <Button mode=\"flat\" link={this.props.id}>\n                  View\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" onClick={this.props.startReview}>\n                  Review\n                </Button>\n              </div>\n              <div className=\"button-pad\">\n                <Button mode=\"flat\" design=\"danger\" colorChange=\"colorChange\" onClick={this.bucketHandler}>\n                  {this.state.btnTitle}\n                </Button>\n              </div>\n            </Row>\n          </Container>\n        </article>\n      )\n    }\n    \n  }\n}\n\nexport default post;\n"]},"metadata":{},"sourceType":"module"}