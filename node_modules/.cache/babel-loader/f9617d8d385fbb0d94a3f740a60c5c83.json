{"ast":null,"code":"import _objectSpread from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js\";\nimport React, { Component } from 'react';\nimport openSocket from 'socket.io-client';\nimport Loader from '../../components/Loader/Loader';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL, { Marker } from \"react-map-gl\";\nimport Pin from '../../components/Pin/pin';\nvar MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Map)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isEditing: false,\n      spots: [],\n      postsLoading: true,\n      viewport: {\n        width: '800px',\n        height: '400px',\n        latitude: 44.161,\n        longitude: -98.464,\n        zoom: 2\n      }\n    };\n\n    _this.loadPosts = function () {\n      fetch('http://localhost:8080/feed/all-posts', {\n        headers: {\n          Authorization: 'Bearer ' + _this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        return _objectSpread({}, resData, {\n          posts: resData.posts.filter(function (post) {\n            return _this.state.bucket.includes(post._id);\n          })\n        });\n      }).then(function (resData) {\n        _this.setState({\n          spots: resData.posts.map(function (post) {\n            return _objectSpread({}, post, {\n              imagePath: post.imageUrl\n            });\n          }),\n          postsLoading: false\n        });\n      }).catch(_this.catchError);\n    };\n\n    _this.createMarkers = function () {\n      var markers = [];\n\n      for (var i = 0; i < _this.state.spots.length; i++) {\n        markers.push(React.createElement(Marker, {\n          latitude: _this.state.spots[i].location.center[1],\n          longitude: _this.state.spots[i].location.center[0],\n          offsetLeft: -15,\n          offsetTop: -30,\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 97\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103\n          },\n          __self: this\n        }, React.createElement(Pin, {\n          key: i,\n          title: _this.state.spots[i].title,\n          image: _this.state.spots[i].imageUrl,\n          location: _this.state.spots[i].location.text,\n          id: _this.state.spots[i]._id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104\n          },\n          __self: this\n        }))));\n      }\n\n      return markers;\n    };\n\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket posts failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        _this2.setState({\n          bucket: resData.bucket\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n      this.loadPosts();\n      var socket = openSocket('http://localhost:8080');\n      socket.on('posts', function (data) {\n        if (data.action === 'create') {\n          _this2.loadPosts();\n        } else if (data.action === 'update') {\n          _this2.updatePost(data.post);\n        } else if (data.action === 'delete') {\n          _this2.loadPosts();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      if (this.state.postsLoading) {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 119\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, React.createElement(ReactMapGL, Object.assign({}, this.state.viewport, {\n        onViewportChange: function onViewportChange(viewport) {\n          return _this3.setState({\n            viewport: viewport\n          });\n        },\n        mapboxApiAccessToken: MAPBOX_TOKEN,\n        mapStyle: \"mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }), this.createMarkers));\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nexport default Map;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js"],"names":["React","Component","openSocket","Loader","ReactMapGL","Marker","Pin","MAPBOX_TOKEN","Map","state","isEditing","spots","postsLoading","viewport","width","height","latitude","longitude","zoom","loadPosts","fetch","headers","Authorization","props","token","then","res","status","Error","json","resData","posts","filter","post","bucket","includes","_id","setState","map","imagePath","imageUrl","catch","catchError","createMarkers","markers","i","length","push","location","center","title","text","err","console","log","socket","on","data","action","updatePost","display","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport openSocket from 'socket.io-client';\n\nimport Loader from '../../components/Loader/Loader';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL, {Marker} from \"react-map-gl\";\nimport Pin from '../../components/Pin/pin';\n\nconst MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\n\nclass Map extends Component {\n  state = {\n    isEditing: false,\n    spots: [],\n    postsLoading: true,\n    viewport: {\n          width: '800px',\n          height: '400px',\n          latitude: 44.161,\n          longitude: -98.464,\n          zoom: 2\n        }\n  };\n\n  componentDidMount() {\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      })\n        .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error('Fetching bucket posts failed!');\n          }\n          return res.json();\n        })\n        .then(resData => {\n          this.setState({\n            bucket: resData.bucket\n          });\n        })\n        .catch(err => {\n          console.log(err);\n        });  \n    this.loadPosts();\n    const socket = openSocket('http://localhost:8080');\n    socket.on('posts', data => {\n      if (data.action === 'create') {\n        this.loadPosts();\n      } else if (data.action === 'update') {\n        this.updatePost(data.post);\n      } else if (data.action === 'delete') {\n        this.loadPosts();\n      }\n    });\n  }\n\n  loadPosts = () => {\n    fetch('http://localhost:8080/feed/all-posts', {\n      headers: {\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        return {\n            ...resData,\n            posts: resData.posts.filter(\n                post => this.state.bucket.includes(post._id)\n              )\n        }\n    })\n      .then(resData => {\n        this.setState({\n        spots: resData.posts.map(post => {\n            return {\n              ...post,\n              imagePath: post.imageUrl\n            };\n          }),\n          postsLoading: false\n        });\n      })\n      .catch(this.catchError);\n  };\n\n  createMarkers = () => {\n    let markers = []\n    for (let i = 0; i < this.state.spots.length; i++){\n        markers.push(\n            <Marker \n                latitude={this.state.spots[i].location.center[1]} \n                longitude={this.state.spots[i].location.center[0]}\n                offsetLeft={-15}\n                offsetTop={-30}\n                key={i}>\n                <div>\n                <Pin \n                    key={i}\n                    title={this.state.spots[i].title}\n                    image={this.state.spots[i].imageUrl}\n                    location={this.state.spots[i].location.text}\n                    id={this.state.spots[i]._id}/>\n                </div>\n            </Marker>\n        );\n    }\n    return markers;\n  }\n\n  render() {\n    if (this.state.postsLoading){\n        return <Loader />\n    }\n    return (<div style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center'\n      }}>\n        <ReactMapGL\n            {...this.state.viewport}\n            onViewportChange={(viewport) => this.setState({viewport})}\n            mapboxApiAccessToken={MAPBOX_TOKEN}\n            mapStyle='mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt'\n        >\n        {this.createMarkers}\n        </ReactMapGL>\n      </div>\n    );\n  }\n}\n\nexport default Map;"]},"metadata":{},"sourceType":"module"}