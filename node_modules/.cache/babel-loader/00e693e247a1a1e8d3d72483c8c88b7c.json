{"ast":null,"code":"import _regeneratorRuntime from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/SHAWN/Downloads/SpotShare/src/App.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Layout from './components/Layout/Layout';\nimport Backdrop from './components/Backdrop/Backdrop';\nimport Toolbar from './components/Toolbar/Toolbar';\nimport MainNavigation from './components/Navigation/MainNavigation/MainNavigation';\nimport MobileNavigation from './components/Navigation/MobileNavigation/MobileNavigation';\nimport ErrorHandler from './components/ErrorHandler/ErrorHandler';\nimport FeedPage from './pages/Feed/Feed';\nimport Profile from './pages/Profile/Profile';\nimport Rankings from './pages/Ranking/Ranking';\nimport Map from './pages/Map/Map';\nimport Bucket from './pages/Bucket/Bucket';\nimport SinglePostPage from './pages/Feed/SinglePost/SinglePost';\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: false,\n      token: null,\n      userId: null,\n      authLoading: false,\n      error: null,\n      navState: null,\n      name: null\n    };\n\n    _this.mobileNavHandler = function (isOpen) {\n      _this.setState({\n        showMobileNav: isOpen,\n        showBackdrop: isOpen\n      });\n    };\n\n    _this.backdropClickHandler = function () {\n      _this.setState({\n        showBackdrop: false,\n        showMobileNav: false,\n        error: null\n      });\n    };\n\n    _this.getUserName = function () {\n      var userId = localStorage.getItem('userId');\n      var token = localStorage.getItem('token');\n      fetch('http://localhost:8080/auth/user/' + userId, {\n        method: 'GET',\n        headers: {\n          Authorization: 'Bearer ' + token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching user name failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData.userObj.name);\n\n        _this.setState({\n          name: resData.userObj.name\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n    };\n\n    _this.logoutHandler =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return fetch('http://localhost:8080/auth/status', {\n                method: 'PATCH',\n                headers: {\n                  Authorization: 'Bearer ' + localStorage.getItem('token'),\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                  status: ''\n                })\n              });\n\n            case 3:\n              res = _context.sent;\n\n              if (!(res.status !== 200 && res.status !== 201)) {\n                _context.next = 6;\n                break;\n              }\n\n              throw new Error(\"Can't update status!\");\n\n            case 6:\n              _this.setState({\n                isAuth: false,\n                token: null,\n                navState: null\n              });\n\n              localStorage.clear();\n              window.location.reload();\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 11]]);\n    }));\n\n    _this.loginHandler =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event, authData) {\n        var res, resData, remainingMilliseconds, expiryDate, userId, token, res2, resData2;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                event.preventDefault();\n\n                _this.setState({\n                  authLoading: true\n                });\n\n                _context2.prev = 2;\n                _context2.next = 5;\n                return fetch('http://localhost:8080/auth/login', {\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify({\n                    email: authData.email,\n                    password: authData.password\n                  })\n                });\n\n              case 5:\n                res = _context2.sent;\n\n                if (!(res.status === 422)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                throw new Error('Validation failed.');\n\n              case 8:\n                if (!(res.status !== 200 && res.status !== 201)) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                console.log('Error!');\n                throw new Error('Could not authenticate you!');\n\n              case 11:\n                _context2.next = 13;\n                return res.json();\n\n              case 13:\n                resData = _context2.sent;\n                localStorage.setItem('token', resData.token);\n                localStorage.setItem('userId', resData.userId);\n                remainingMilliseconds = 60 * 60 * 1000;\n                expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n                localStorage.setItem('expiryDate', expiryDate.toISOString());\n                _context2.next = 21;\n                return _this.setAutoLogout(remainingMilliseconds);\n\n              case 21:\n                userId = localStorage.getItem('userId');\n                token = localStorage.getItem('token');\n                _context2.next = 25;\n                return fetch('http://localhost:8080/auth/user/' + userId, {\n                  method: 'GET',\n                  headers: {\n                    Authorization: 'Bearer ' + token\n                  }\n                });\n\n              case 25:\n                res2 = _context2.sent;\n\n                if (!(res2.status !== 200 && res2.status !== 201)) {\n                  _context2.next = 28;\n                  break;\n                }\n\n                throw new Error('Fetching user name failed!');\n\n              case 28:\n                _context2.next = 30;\n                return res2.json();\n\n              case 30:\n                resData2 = _context2.sent;\n                _context2.next = 33;\n                return _this.setState({\n                  isAuth: true,\n                  token: resData.token,\n                  authLoading: false,\n                  userId: resData.userId,\n                  name: resData2.userObj.name\n                });\n\n              case 33:\n                _context2.next = 39;\n                break;\n\n              case 35:\n                _context2.prev = 35;\n                _context2.t0 = _context2[\"catch\"](2);\n                console.log(_context2.t0);\n\n                _this.setState({\n                  isAuth: false,\n                  authLoading: false,\n                  error: _context2.t0\n                });\n\n              case 39:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[2, 35]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.signupHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      fetch('http://localhost:8080/auth/signup', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email: authData.signupForm.email.value,\n          password: authData.signupForm.password.value,\n          name: authData.signupForm.name.value\n        })\n      }).then(function (res) {\n        if (res.status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        _this.setState({\n          isAuth: false,\n          authLoading: false\n        });\n\n        _this.props.history.replace('/');\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.setAutoLogout = function (milliseconds) {\n      setTimeout(function () {\n        _this.logoutHandler();\n      }, milliseconds);\n    };\n\n    _this.errorHandler = function () {\n      _this.setState({\n        error: null\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var token, expiryDate, userId, remainingMilliseconds;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                token = localStorage.getItem('token');\n                expiryDate = localStorage.getItem('expiryDate');\n\n                if (!(!token || !expiryDate)) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 4:\n                if (!(new Date(expiryDate) <= new Date())) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                this.logoutHandler();\n                return _context3.abrupt(\"return\");\n\n              case 7:\n                userId = localStorage.getItem('userId');\n                _context3.next = 10;\n                return this.getUserName();\n\n              case 10:\n                console.log(name);\n                remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n                this.setState({\n                  isAuth: true,\n                  token: token,\n                  userId: userId,\n                  name: name\n                });\n                this.setAutoLogout(remainingMilliseconds);\n\n              case 14:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      console.log(this.state.userId);\n      console.log(this.state.name);\n      var routes = React.createElement(Switch, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(Route, {\n        path: \"/\",\n        exact: true,\n        render: function render(props) {\n          return React.createElement(LoginPage, Object.assign({}, props, {\n            onLogin: _this2.loginHandler,\n            loading: _this2.state.authLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 228\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/signup\",\n        exact: true,\n        render: function render(props) {\n          return React.createElement(SignupPage, Object.assign({}, props, {\n            onSignup: _this2.signupHandler,\n            loading: _this2.state.authLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 239\n            },\n            __self: this\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }), \")} />\", React.createElement(Redirect, {\n        to: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }));\n\n      if (this.state.isAuth) {\n        routes = React.createElement(Switch, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 253\n          },\n          __self: this\n        }, React.createElement(Route, {\n          path: \"/posts\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(Profile, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 258\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 254\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/my-bucket\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(Bucket, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 265\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 261\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/my-map\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(Map, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 272\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 268\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/rankings\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(Rankings, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 279\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 275\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/\",\n          exact: true,\n          render: function render(props) {\n            return React.createElement(FeedPage, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 286\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 282\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/:postId\",\n          render: function render(props) {\n            return React.createElement(SinglePostPage, Object.assign({}, props, {\n              userId: _this2.state.userId,\n              token: _this2.state.token,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 292\n              },\n              __self: this\n            }));\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 289\n          },\n          __self: this\n        }), React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 299\n          },\n          __self: this\n        }));\n      }\n\n      return React.createElement(Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304\n        },\n        __self: this\n      }, this.state.showBackdrop && React.createElement(Backdrop, {\n        onClick: this.backdropClickHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }), React.createElement(ErrorHandler, {\n        error: this.state.error,\n        onHandle: this.errorHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308\n        },\n        __self: this\n      }), React.createElement(Layout, {\n        header: React.createElement(Toolbar, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 311\n          },\n          __self: this\n        }, React.createElement(MainNavigation, {\n          onOpenMobileNav: this.mobileNavHandler.bind(this, true),\n          onLogout: this.logoutHandler,\n          isAuth: this.state.isAuth,\n          isLoading: this.state.authLoading,\n          userId: this.state.userId,\n          token: this.state.token,\n          state: this.state.navState,\n          name: this.state.name,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312\n          },\n          __self: this\n        })),\n        mobileNav: React.createElement(MobileNavigation, {\n          open: this.state.showMobileNav,\n          mobile: true,\n          onChooseItem: this.mobileNavHandler.bind(this, false),\n          onLogout: this.logoutHandler,\n          isAuth: this.state.isAuth,\n          isLoading: this.state.authLoading,\n          userId: this.state.userId,\n          token: this.state.token,\n          name: this.state.name,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 325\n          },\n          __self: this\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }), routes);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default withRouter(App);","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/App.js"],"names":["React","Component","Fragment","Route","Switch","Redirect","withRouter","Layout","Backdrop","Toolbar","MainNavigation","MobileNavigation","ErrorHandler","FeedPage","Profile","Rankings","Map","Bucket","SinglePostPage","LoginPage","SignupPage","App","state","showBackdrop","showMobileNav","isAuth","token","userId","authLoading","error","navState","name","mobileNavHandler","isOpen","setState","backdropClickHandler","getUserName","localStorage","getItem","fetch","method","headers","Authorization","then","res","status","Error","json","resData","console","log","userObj","catch","err","logoutHandler","body","JSON","stringify","clear","window","location","reload","loginHandler","event","authData","preventDefault","email","password","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","res2","resData2","signupHandler","signupForm","value","props","history","replace","milliseconds","setTimeout","errorHandler","routes","bind"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\n\nimport Layout from './components/Layout/Layout';\nimport Backdrop from './components/Backdrop/Backdrop';\nimport Toolbar from './components/Toolbar/Toolbar';\nimport MainNavigation from './components/Navigation/MainNavigation/MainNavigation';\nimport MobileNavigation from './components/Navigation/MobileNavigation/MobileNavigation';\nimport ErrorHandler from './components/ErrorHandler/ErrorHandler';\nimport FeedPage from './pages/Feed/Feed';\nimport Profile from './pages/Profile/Profile';\nimport Rankings from './pages/Ranking/Ranking';\nimport Map from './pages/Map/Map';\nimport Bucket from './pages/Bucket/Bucket';\nimport SinglePostPage from './pages/Feed/SinglePost/SinglePost';\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\n\nclass App extends Component {\n  state = {\n    showBackdrop: false,\n    showMobileNav: false,\n    isAuth: false,\n    token: null,\n    userId: null,\n    authLoading: false,\n    error: null,\n    navState: null, \n    name: null\n  };\n\n  async componentDidMount () {\n    const token = localStorage.getItem('token');\n    const expiryDate = localStorage.getItem('expiryDate');\n    if (!token || !expiryDate) {\n      return;\n    }\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n    const userId = localStorage.getItem('userId');\n    await this.getUserName();\n    console.log(name);\n    const remainingMilliseconds =\n      new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({ isAuth: true, token: token, userId: userId, name: name });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  mobileNavHandler = isOpen => {\n    this.setState({ showMobileNav: isOpen, showBackdrop: isOpen });\n  };\n\n  backdropClickHandler = () => {\n    this.setState({ showBackdrop: false, showMobileNav: false, error: null });\n  };\n\n  getUserName = () => {\n    let userId = localStorage.getItem('userId');\n    let token = localStorage.getItem('token');\n    fetch('http://localhost:8080/auth/user/' + userId, {\n        method: 'GET',\n        headers: {\n          Authorization: 'Bearer ' + token\n        }\n      })\n      .then(res => {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching user name failed!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData.userObj.name);\n        this.setState({\n          name: resData.userObj.name\n        })\n      })\n      .catch(err => {\n        console.log(err);\n      });\n    }\n\n  logoutHandler = async () => {\n    try {\n      const res = await fetch('http://localhost:8080/auth/status', {\n        method: 'PATCH',\n        headers: {\n          Authorization: 'Bearer ' + localStorage.getItem('token'),\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          status: ''\n        })\n      })\n      if (res.status !== 200 && res.status !== 201) {\n        throw new Error(\"Can't update status!\");\n      }\n      this.setState({ isAuth: false, token: null, navState: null });\n      localStorage.clear();\n      window.location.reload();\n    }catch(err){\n      console.log(err)\n    }\n  };\n\n  loginHandler = async (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    try {\n      const res = await fetch('http://localhost:8080/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email: authData.email,\n          password: authData.password\n        })\n      })\n      if (res.status === 422) {\n        throw new Error('Validation failed.');\n      }\n      if (res.status !== 200 && res.status !== 201) {\n        console.log('Error!');\n        throw new Error('Could not authenticate you!');\n      }\n      const resData = await res.json();\n      localStorage.setItem('token', resData.token);\n      localStorage.setItem('userId', resData.userId);\n      const remainingMilliseconds = 60 * 60 * 1000;\n      const expiryDate = new Date(\n            new Date().getTime() + remainingMilliseconds\n          );\n      localStorage.setItem('expiryDate', expiryDate.toISOString());\n      await this.setAutoLogout(remainingMilliseconds);\n      let userId = localStorage.getItem('userId');\n      let token = localStorage.getItem('token');\n      const res2 = await fetch('http://localhost:8080/auth/user/' + userId, {\n          method: 'GET',\n          headers: {\n            Authorization: 'Bearer ' + token\n          }\n        })\n      if (res2.status !== 200 && res2.status !== 201) {\n          throw new Error('Fetching user name failed!');\n      }\n      const resData2 = await res2.json();\n      await this.setState({\n        isAuth: true,\n        token: resData.token,\n        authLoading: false,\n        userId: resData.userId,\n        name: resData2.userObj.name\n      })\n    }catch (err){\n      console.log(err);\n      this.setState({\n        isAuth: false,\n        authLoading: false,\n        error: err\n      });\n    }\n  };\n\n  signupHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    fetch('http://localhost:8080/auth/signup', {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        email: authData.signupForm.email.value,\n        password: authData.signupForm.password.value,\n        name: authData.signupForm.name.value\n      })\n    })\n      .then(res => {\n        if (res.status === 422) {\n          throw new Error(\n            \"Validation failed. Make sure the email address isn't used yet!\"\n          );\n        }\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        this.setState({ isAuth: false, authLoading: false });\n        this.props.history.replace('/');\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  setAutoLogout = milliseconds => {\n    setTimeout(() => {\n      this.logoutHandler();\n    }, milliseconds);\n  };\n\n  errorHandler = () => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    console.log(this.state.userId);\n    console.log(this.state.name);\n\n    let routes = (\n      <Switch>\n        <Route\n          path=\"/\"\n          exact\n          render={props => (\n            <LoginPage\n              {...props}\n              onLogin={this.loginHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n        <Route\n          path=\"/signup\"\n          exact\n          render={props => (\n            <SignupPage\n              {...props}\n              onSignup={this.signupHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n          )}\n        />\n        <Redirect to=\"/\" />\n      </Switch>\n    );\n    if (this.state.isAuth) {\n      routes = (\n        <Switch>\n          <Route\n            path=\"/posts\"\n            exact\n            render={props => (\n              <Profile userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/my-bucket\"\n            exact\n            render={props => (\n              <Bucket userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/my-map\"\n            exact\n            render={props => (\n              <Map userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/rankings\"\n            exact\n            render={props => (\n              <Rankings userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/\"\n            exact\n            render={props => (\n              <FeedPage userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/:postId\"\n            render={props => (\n              <SinglePostPage\n                {...props}\n                userId={this.state.userId}\n                token={this.state.token}\n              />\n            )}\n          />\n          <Redirect to=\"/\" />\n        </Switch>\n      );\n    }\n    return (\n      <Fragment>\n        {this.state.showBackdrop && (\n          <Backdrop onClick={this.backdropClickHandler} />\n        )}\n        <ErrorHandler error={this.state.error} onHandle={this.errorHandler} />\n        <Layout\n          header={\n            <Toolbar>\n              <MainNavigation\n                onOpenMobileNav={this.mobileNavHandler.bind(this, true)}\n                onLogout={this.logoutHandler}\n                isAuth={this.state.isAuth}\n                isLoading={this.state.authLoading}\n                userId={this.state.userId}\n                token={this.state.token}\n                state={this.state.navState}\n                name={this.state.name}\n              />\n            </Toolbar>\n          }\n          mobileNav={\n            <MobileNavigation\n              open={this.state.showMobileNav}\n              mobile\n              onChooseItem={this.mobileNavHandler.bind(this, false)}\n              onLogout={this.logoutHandler}\n              isAuth={this.state.isAuth}\n              isLoading={this.state.authLoading}\n              userId={this.state.userId}\n              token={this.state.token}\n              name={this.state.name}\n            />\n          }\n        />\n        {routes}\n      </Fragment>\n    );\n  }\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}