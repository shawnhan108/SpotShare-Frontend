{"ast":null,"code":"import _objectSpread from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js\";\nimport React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL from \"react-map-gl\";\nvar MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Map)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isEditing: false,\n      spots: [],\n      totalSpots: 0,\n      postsLoading: true,\n      viewport: {\n        width: 650,\n        height: 350,\n        latitude: 0,\n        longitude: 0,\n        zoom: 8\n      }\n    };\n\n    _this.loadPosts = function () {\n      fetch('http://localhost:8080/feed/posts', {\n        headers: {\n          Authorization: 'Bearer ' + _this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n        return _objectSpread({}, resData, {\n          posts: resData.posts.filter(function (post) {\n            return _this.state.bucket.includes(post._id);\n          })\n        });\n      }).then(function (resData) {\n        _this.setState({\n          spots: resData.posts.map(function (post) {\n            return _objectSpread({}, post, {\n              imagePath: post.imageUrl\n            });\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      }).catch(_this.catchError);\n    };\n\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket posts failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this2.setState({\n          bucket: resData.bucket\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n      this.loadPosts();\n      var socket = openSocket('http://localhost:8080');\n      socket.on('posts', function (data) {\n        if (data.action === 'create') {\n          _this2.addPost(data.post);\n        } else if (data.action === 'update') {\n          _this2.updatePost(data.post);\n        } else if (data.action === 'delete') {\n          _this2.loadPosts();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      console.log(this.state.spots);\n      return React.createElement(ReactMapGL, Object.assign({}, this.state.viewport, {\n        onViewportChange: function onViewportChange(viewport) {\n          return _this3.setState({\n            viewport: viewport\n          });\n        },\n        mapboxApiAccessToken: MAPBOX_TOKEN,\n        mapStyle: \"mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nexport default Map;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js"],"names":["React","Component","Fragment","openSocket","Post","Button","FeedEdit","Input","Paginator","Loader","ErrorHandler","ReactMapGL","MAPBOX_TOKEN","Map","state","isEditing","spots","totalSpots","postsLoading","viewport","width","height","latitude","longitude","zoom","loadPosts","fetch","headers","Authorization","props","token","then","res","status","Error","json","resData","console","log","posts","filter","post","bucket","includes","_id","setState","map","imagePath","imageUrl","totalItems","catch","catchError","err","socket","on","data","action","addPost","updatePost"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\n\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL from \"react-map-gl\";\n\nconst MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\n\n\nclass Map extends Component {\n  state = {\n    isEditing: false,\n    spots: [],\n    totalSpots: 0,\n    postsLoading: true,\n    viewport: {\n          width: 650,\n          height: 350,\n          latitude: 0,\n          longitude: 0,\n          zoom: 8\n        }\n  };\n\n  componentDidMount() {\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      })\n        .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error('Fetching bucket posts failed!');\n          }\n          return res.json();\n        })\n        .then(resData => {\n          console.log(resData);\n          this.setState({\n            bucket: resData.bucket\n          });\n        })\n        .catch(err => {\n          console.log(err);\n        });  \n    this.loadPosts();\n    const socket = openSocket('http://localhost:8080');\n    socket.on('posts', data => {\n      if (data.action === 'create') {\n        this.addPost(data.post);\n      } else if (data.action === 'update') {\n        this.updatePost(data.post);\n      } else if (data.action === 'delete') {\n        this.loadPosts();\n      }\n    });\n  }\n\n  loadPosts = () => {\n    fetch('http://localhost:8080/feed/posts', {\n      headers: {\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        return {\n            ...resData,\n            posts: resData.posts.filter(\n                post => this.state.bucket.includes(post._id)\n              )\n        }\n    })\n      .then(resData => {\n        this.setState({\n        spots: resData.posts.map(post => {\n            return {\n              ...post,\n              imagePath: post.imageUrl\n            };\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      })\n      .catch(this.catchError);\n  };\n\n  render() {\n    console.log(this.state.spots);\n    return (\n      <ReactMapGL\n        {...this.state.viewport}\n        onViewportChange={(viewport) => this.setState({viewport})}\n        mapboxApiAccessToken={MAPBOX_TOKEN}\n        mapStyle='mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt'\n      />\n    );\n  }\n}\n\nexport default Map;"]},"metadata":{},"sourceType":"module"}