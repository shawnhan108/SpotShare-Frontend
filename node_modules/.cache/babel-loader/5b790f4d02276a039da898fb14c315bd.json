{"ast":null,"code":"import _objectSpread from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Map)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isEditing: false,\n      spots: [],\n      totalSpots: 0,\n      postsLoading: true\n    };\n\n    _this.loadPosts = function () {\n      fetch('http://localhost:8080/feed/posts', {\n        headers: {\n          method: 'GET',\n          Authorization: 'Bearer ' + _this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n        return _objectSpread({}, resData, {\n          posts: resData.posts.filter(function (post) {\n            return _this.state.bucket.includes(post._id);\n          })\n        });\n      }).then(function (resData) {\n        _this.setState({\n          spots: resData.posts.map(function (post) {\n            return _objectSpread({}, post, {\n              imagePath: post.imageUrl\n            });\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      }).catch(_this.catchError);\n    };\n\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('http://localhost:8080/auth/status', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch user status.');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        _this2.setState({\n          status: resData.status\n        });\n      }).catch(this.catchError);\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket posts failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this2.setState({\n          bucket: resData.bucket\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n      this.loadPosts();\n      var socket = openSocket('http://localhost:8080');\n      socket.on('posts', function (data) {\n        if (data.action === 'create') {\n          _this2.addPost(data.post);\n        } else if (data.action === 'update') {\n          _this2.updatePost(data.post);\n        } else if (data.action === 'delete') {\n          _this2.loadPosts();\n        }\n      });\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nexport default Map;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js"],"names":["React","Component","Fragment","openSocket","Post","Button","FeedEdit","Input","Paginator","Loader","ErrorHandler","Map","state","isEditing","spots","totalSpots","postsLoading","loadPosts","fetch","headers","method","Authorization","props","token","then","res","status","Error","json","resData","console","log","posts","filter","post","bucket","includes","_id","setState","map","imagePath","imageUrl","totalItems","catch","catchError","err","socket","on","data","action","addPost","updatePost"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\n\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\n\nclass Map extends Component {\n  state = {\n    isEditing: false,\n    spots: [],\n    totalSpots: 0,\n    postsLoading: true\n  };\n\n  componentDidMount() {\n    fetch('http://localhost:8080/auth/status', {\n      headers: {\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch user status.');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        this.setState({ \n          status: resData.status });\n      })\n      .catch(this.catchError);\n    \n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      })\n        .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error('Fetching bucket posts failed!');\n          }\n          return res.json();\n        })\n        .then(resData => {\n          console.log(resData);\n          this.setState({\n            bucket: resData.bucket\n          });\n        })\n        .catch(err => {\n          console.log(err);\n        });  \n    this.loadPosts();\n    const socket = openSocket('http://localhost:8080');\n    socket.on('posts', data => {\n      if (data.action === 'create') {\n        this.addPost(data.post);\n      } else if (data.action === 'update') {\n        this.updatePost(data.post);\n      } else if (data.action === 'delete') {\n        this.loadPosts();\n      }\n    });\n  }\n\n  loadPosts = () => {\n    fetch('http://localhost:8080/feed/posts', {\n      headers: {\n        method: 'GET',\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        return {\n            ...resData,\n            posts: resData.posts.filter(\n                post => this.state.bucket.includes(post._id)\n              )\n        }\n    })\n      .then(resData => {\n        this.setState({\n        spots: resData.posts.map(post => {\n            return {\n              ...post,\n              imagePath: post.imageUrl\n            };\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      })\n      .catch(this.catchError);\n  };\n}\n\nexport default Map;"]},"metadata":{},"sourceType":"module"}