{"ast":null,"code":"module.exports = function () {\n  function isThenable(obj) {\n    return obj && obj instanceof Object && typeof obj.then === \"function\";\n  }\n\n  function resolution(p, r, how) {\n    try {\n      /* 2.2.7.1 */\n      var x = how ? how(r) : r;\n      if (p === x)\n        /* 2.3.1 */\n        return p.reject(new TypeError(\"Promise resolution loop\"));\n\n      if (isThenable(x)) {\n        /* 2.3.3 */\n        x.then(function (y) {\n          resolution(p, y);\n        }, function (e) {\n          p.reject(e);\n        });\n      } else {\n        p.resolve(x);\n      }\n    } catch (ex) {\n      /* 2.2.7.2 */\n      p.reject(ex);\n    }\n  }\n\n  function _unchained(v) {}\n\n  function thenChain(res, rej) {\n    this.resolve = res;\n    this.reject = rej;\n  }\n\n  function Chained() {}\n\n  ;\n  Chained.prototype = {\n    resolve: _unchained,\n    reject: _unchained,\n    then: thenChain\n  };\n\n  function then(res, rej) {\n    var chain = new Chained();\n\n    try {\n      this._resolver(function (value) {\n        return isThenable(value) ? value.then(res, rej) : resolution(chain, value, res);\n      }, function (ex) {\n        resolution(chain, ex, rej);\n      });\n    } catch (ex) {\n      resolution(chain, ex, rej);\n    }\n\n    return chain;\n  }\n\n  function Thenable(resolver) {\n    this._resolver = resolver;\n    this.then = then;\n  }\n\n  ;\n\n  Thenable.resolve = function (v) {\n    return Thenable.isThenable(v) ? v : {\n      then: function then(resolve) {\n        return resolve(v);\n      }\n    };\n  };\n\n  Thenable.isThenable = isThenable;\n  return Thenable;\n};","map":null,"metadata":{},"sourceType":"script"}