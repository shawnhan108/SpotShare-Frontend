{"ast":null,"code":"import _objectSpread from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/SHAWN/Downloads/SpotShare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js\";\nimport React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL, { Marker, Popup, NavigationControl } from \"react-map-gl\";\nimport Pin from '../../components/Pin/pin';\nvar MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\nvar navStyle = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  padding: '10px'\n};\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Map)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isEditing: false,\n      spots: [],\n      totalSpots: 0,\n      postsLoading: true,\n      viewport: {\n        width: 850,\n        height: 500,\n        latitude: 44.161,\n        longitude: -98.464,\n        zoom: 2\n      },\n      popupInfo: null\n    };\n\n    _this.loadPosts = function () {\n      fetch('http://localhost:8080/feed/posts', {\n        headers: {\n          Authorization: 'Bearer ' + _this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n        return _objectSpread({}, resData, {\n          posts: resData.posts.filter(function (post) {\n            return _this.state.bucket.includes(post._id);\n          })\n        });\n      }).then(function (resData) {\n        _this.setState({\n          spots: resData.posts.map(function (post) {\n            return _objectSpread({}, post, {\n              imagePath: post.imageUrl\n            });\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      }).catch(_this.catchError);\n    };\n\n    _this.createMarkers = function () {\n      var markers = [];\n\n      for (var i = 0; i < _this.state.totalSpots; i++) {\n        console.log(_this.state.spots[i]);\n        markers.push(React.createElement(Marker, {\n          latitude: _this.state.spots[i].location.center[0],\n          longitude: _this.state.spots[i].location.center[1],\n          offsetLeft: -20,\n          offsetTop: -10,\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, React.createElement(Pin, {\n          key: i,\n          title: _this.state.spots[i].title,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124\n          },\n          __self: this\n        }))));\n      }\n\n      return markers;\n    };\n\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      }).then(function (res) {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Fetching bucket posts failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this2.setState({\n          bucket: resData.bucket\n        });\n      }).catch(function (err) {\n        console.log(err);\n      });\n      this.loadPosts();\n      var socket = openSocket('http://localhost:8080');\n      socket.on('posts', function (data) {\n        if (data.action === 'create') {\n          _this2.addPost(data.post);\n        } else if (data.action === 'update') {\n          _this2.updatePost(data.post);\n        } else if (data.action === 'delete') {\n          _this2.loadPosts();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      if (this.state.postsLoading) {\n        return React.createElement(Loader, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136\n          },\n          __self: this\n        });\n      }\n\n      console.log(this.state.spots);\n      return React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, React.createElement(ReactMapGL, Object.assign({}, this.state.viewport, {\n        onViewportChange: function onViewportChange(viewport) {\n          return _this3.setState({\n            viewport: viewport\n          });\n        },\n        mapboxApiAccessToken: MAPBOX_TOKEN,\n        mapStyle: \"mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }), this.createMarkers()));\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nexport default Map;","map":{"version":3,"sources":["/Users/SHAWN/Downloads/SpotShare/src/pages/Map/Map.js"],"names":["React","Component","Fragment","openSocket","Post","Button","FeedEdit","Input","Paginator","Loader","ErrorHandler","ReactMapGL","Marker","Popup","NavigationControl","Pin","MAPBOX_TOKEN","navStyle","position","top","left","padding","Map","state","isEditing","spots","totalSpots","postsLoading","viewport","width","height","latitude","longitude","zoom","popupInfo","loadPosts","fetch","headers","Authorization","props","token","then","res","status","Error","json","resData","console","log","posts","filter","post","bucket","includes","_id","setState","map","imagePath","imageUrl","totalItems","catch","catchError","createMarkers","markers","i","push","location","center","title","err","socket","on","data","action","addPost","updatePost","display","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport openSocket from 'socket.io-client';\n\nimport Post from '../../components/Feed/Post/Post';\nimport Button from '../../components/Button/Button';\nimport FeedEdit from '../../components/Feed/FeedEdit/FeedEdit';\nimport Input from '../../components/Form/Input/Input';\nimport Paginator from '../../components/Paginator/Paginator';\nimport Loader from '../../components/Loader/Loader';\nimport ErrorHandler from '../../components/ErrorHandler/ErrorHandler';\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"react-map-gl-geocoder/dist/mapbox-gl-geocoder.css\";\nimport ReactMapGL, {Marker, Popup, NavigationControl} from \"react-map-gl\";\nimport Pin from '../../components/Pin/pin';\n\nconst MAPBOX_TOKEN = \"pk.eyJ1IjoieTI2MmhhbiIsImEiOiJjanozamU2bmkwMzJ5M2d0Nm84ZW5meHhzIn0.L1kW4Q7vNyX0fCJJEYI5PA\";\n\nconst navStyle = {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    padding: '10px'\n  };\n\nclass Map extends Component {\n  state = {\n    isEditing: false,\n    spots: [],\n    totalSpots: 0,\n    postsLoading: true,\n    viewport: {\n          width: 850,\n          height: 500,\n          latitude: 44.161,\n          longitude: -98.464,\n          zoom: 2\n        },\n    popupInfo: null\n  };\n\n  componentDidMount() {\n      \n      fetch('http://localhost:8080/auth/bucket', {\n        headers: {\n          Authorization: 'Bearer ' + this.props.token\n        }\n      })\n        .then(res => {\n          if (res.status !== 200 && res.status !== 201) {\n            throw new Error('Fetching bucket posts failed!');\n          }\n          return res.json();\n        })\n        .then(resData => {\n          console.log(resData);\n          this.setState({\n            bucket: resData.bucket\n          });\n        })\n        .catch(err => {\n          console.log(err);\n        });  \n    this.loadPosts();\n    const socket = openSocket('http://localhost:8080');\n    socket.on('posts', data => {\n      if (data.action === 'create') {\n        this.addPost(data.post);\n      } else if (data.action === 'update') {\n        this.updatePost(data.post);\n      } else if (data.action === 'delete') {\n        this.loadPosts();\n      }\n    });\n  }\n\n  loadPosts = () => {\n    fetch('http://localhost:8080/feed/posts', {\n      headers: {\n        Authorization: 'Bearer ' + this.props.token\n      }\n    })\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Failed to fetch posts.');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        return {\n            ...resData,\n            posts: resData.posts.filter(\n                post => this.state.bucket.includes(post._id)\n              )\n        }\n    })\n      .then(resData => {\n        this.setState({\n        spots: resData.posts.map(post => {\n            return {\n              ...post,\n              imagePath: post.imageUrl\n            };\n          }),\n          totalSpots: resData.totalItems,\n          postsLoading: false\n        });\n      })\n      .catch(this.catchError);\n  };\n\n  createMarkers = () => {\n    let markers = []\n    for (let i = 0; i < this.state.totalSpots; i++){\n        console.log(this.state.spots[i]);\n        markers.push(\n            <Marker \n                latitude={this.state.spots[i].location.center[0]} \n                longitude={this.state.spots[i].location.center[1]}\n                offsetLeft={-20}\n                offsetTop={-10}\n                key={i}>\n                <div>\n                <Pin key={i}\n                     title={this.state.spots[i].title}/>\n                </div>\n            </Marker>\n        );\n    }\n    return markers;\n  }\n\n  render() {\n    \n    if (this.state.postsLoading){\n        return <Loader />\n    }\n    console.log(this.state.spots);\n    return (<div style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      }}>\n        <ReactMapGL\n            {...this.state.viewport}\n            onViewportChange={(viewport) => this.setState({viewport})}\n            mapboxApiAccessToken={MAPBOX_TOKEN}\n            mapStyle='mapbox://styles/y262han/cjz3kx9a80fby1cr3d8oydttt'\n        >\n        {this.createMarkers()}\n        </ReactMapGL>\n      </div>\n    );\n  }\n}\n\nexport default Map;"]},"metadata":{},"sourceType":"module"}